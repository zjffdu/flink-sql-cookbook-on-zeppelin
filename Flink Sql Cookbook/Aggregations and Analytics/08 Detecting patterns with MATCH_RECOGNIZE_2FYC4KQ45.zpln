{
  "paragraphs": [
    {
      "text": "%md\n\n\u003e :bulb: This example will show how you can use Flink SQL to detect patterns in a stream of events with `MATCH_RECOGNIZE`.\n\nA common (but historically complex) task in SQL day-to-day work is to identify meaningful sequences of events in a data set â€” also known as Complex Event Processing (CEP). This becomes even more relevant when dealing with streaming data, as you want to react quickly to known patterns or changing trends to deliver up-to-date business insights. In Flink SQL, you can easily perform this kind of tasks using the standard SQL clause [`MATCH_RECOGNIZE`](https://ci.apache.org/projects/flink/flink-docs-stable/dev/table/streaming/match_recognize.html).\n\n## Breaking down MATCH_RECOGNIZE\n\nIn this example, you want to find users that downgraded their service subscription from one of the premium tiers (`type IN (\u0027premium\u0027,\u0027platinum\u0027)`) to the basic tier. \n\n#### Input\n\nThe input argument of `MATCH_RECOGNIZE` will be a row pattern table based on `subscriptions`. As a first step, logical partitioning and ordering must be applied to the input row pattern table to ensure that event processing is correct and deterministic:\n\n```sql\nPARTITION BY user_id \nORDER BY proc_time\n```\n\n#### Output\n\nRow pattern columns are then defined in the `MEASURES` clause, which can be thought of as the `SELECT` of `MATCH_RECOGNIZE`. If you\u0027re interested in getting the type of premium subscription associated with the last event before the downgrade, you can fetch it using the [logical offset](https://ci.apache.org/projects/flink/flink-docs-stable/dev/table/streaming/match_recognize.html#logical-offsets) operator `LAST`. The downgrade date can be extrapolated from the `start_date` of the first basic subscription event following any existing premium one(s).\n\n```sql\nMEASURES\n  LAST(PREMIUM.type) AS premium_type,\n  AVG(TIMESTAMPDIFF(DAY,PREMIUM.start_date,PREMIUM.end_date)) AS premium_avg_duration,\n  BASIC.start_date AS downgrade_date\nAFTER MATCH SKIP PAST LAST ROW\n```\n\n#### Pattern Definition\n\nPatterns are specified in the `PATTERN` clause using row-pattern variables (i.e. event types) and regular expressions. These variables must also be associated with the matching conditions that events must meet to be included in the pattern, using the `DEFINE` clause. Here, you are interested in matching one or more premium subscription events (`PREMIUM+`) followed by a basic subscription event (`BASIC`):\n\n```sql\nPATTERN (PREMIUM+ BASIC)\nDEFINE PREMIUM AS PREMIUM.type IN (\u0027premium\u0027,\u0027platinum\u0027),\nBASIC AS BASIC.type \u003d \u0027basic\u0027);\n```\n",
      "user": "anonymous",
      "dateUpdated": "2021-10-08 16:31:04.370",
      "progress": 0,
      "config": {
        "tableHide": false,
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true,
          "completionKey": "TAB",
          "completionSupport": false
        },
        "colWidth": 12.0,
        "editorMode": "ace/mode/markdown",
        "fontSize": 9.0,
        "editorHide": true,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "\u003cdiv class\u003d\"markdown-body\"\u003e\n\u003cblockquote\u003e\n\u003cp\u003eğŸ’¡ This example will show how you can use Flink SQL to detect patterns in a stream of events with \u003ccode\u003eMATCH_RECOGNIZE\u003c/code\u003e.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eA common (but historically complex) task in SQL day-to-day work is to identify meaningful sequences of events in a data set â€” also known as Complex Event Processing (CEP). This becomes even more relevant when dealing with streaming data, as you want to react quickly to known patterns or changing trends to deliver up-to-date business insights. In Flink SQL, you can easily perform this kind of tasks using the standard SQL clause \u003ca href\u003d\"https://ci.apache.org/projects/flink/flink-docs-stable/dev/table/streaming/match_recognize.html\"\u003e\u003ccode\u003eMATCH_RECOGNIZE\u003c/code\u003e\u003c/a\u003e.\u003c/p\u003e\n\u003ch2\u003eBreaking down MATCH_RECOGNIZE\u003c/h2\u003e\n\u003cp\u003eIn this example, you want to find users that downgraded their service subscription from one of the premium tiers (\u003ccode\u003etype IN (\u0027premium\u0027,\u0027platinum\u0027)\u003c/code\u003e) to the basic tier.\u003c/p\u003e\n\u003ch4\u003eInput\u003c/h4\u003e\n\u003cp\u003eThe input argument of \u003ccode\u003eMATCH_RECOGNIZE\u003c/code\u003e will be a row pattern table based on \u003ccode\u003esubscriptions\u003c/code\u003e. As a first step, logical partitioning and ordering must be applied to the input row pattern table to ensure that event processing is correct and deterministic:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class\u003d\"language-sql\"\u003ePARTITION BY user_id \nORDER BY proc_time\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4\u003eOutput\u003c/h4\u003e\n\u003cp\u003eRow pattern columns are then defined in the \u003ccode\u003eMEASURES\u003c/code\u003e clause, which can be thought of as the \u003ccode\u003eSELECT\u003c/code\u003e of \u003ccode\u003eMATCH_RECOGNIZE\u003c/code\u003e. If you\u0026rsquo;re interested in getting the type of premium subscription associated with the last event before the downgrade, you can fetch it using the \u003ca href\u003d\"https://ci.apache.org/projects/flink/flink-docs-stable/dev/table/streaming/match_recognize.html#logical-offsets\"\u003elogical offset\u003c/a\u003e operator \u003ccode\u003eLAST\u003c/code\u003e. The downgrade date can be extrapolated from the \u003ccode\u003estart_date\u003c/code\u003e of the first basic subscription event following any existing premium one(s).\u003c/p\u003e\n\u003cpre\u003e\u003ccode class\u003d\"language-sql\"\u003eMEASURES\n  LAST(PREMIUM.type) AS premium_type,\n  AVG(TIMESTAMPDIFF(DAY,PREMIUM.start_date,PREMIUM.end_date)) AS premium_avg_duration,\n  BASIC.start_date AS downgrade_date\nAFTER MATCH SKIP PAST LAST ROW\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4\u003ePattern Definition\u003c/h4\u003e\n\u003cp\u003ePatterns are specified in the \u003ccode\u003ePATTERN\u003c/code\u003e clause using row-pattern variables (i.e. event types) and regular expressions. These variables must also be associated with the matching conditions that events must meet to be included in the pattern, using the \u003ccode\u003eDEFINE\u003c/code\u003e clause. Here, you are interested in matching one or more premium subscription events (\u003ccode\u003ePREMIUM+\u003c/code\u003e) followed by a basic subscription event (\u003ccode\u003eBASIC\u003c/code\u003e):\u003c/p\u003e\n\u003cpre\u003e\u003ccode class\u003d\"language-sql\"\u003ePATTERN (PREMIUM+ BASIC)\nDEFINE PREMIUM AS PREMIUM.type IN (\u0027premium\u0027,\u0027platinum\u0027),\nBASIC AS BASIC.type \u003d \u0027basic\u0027);\n\u003c/code\u003e\u003c/pre\u003e\n\n\u003c/div\u003e"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1614313983592_107698209",
      "id": "paragraph_1614313983592_107698209",
      "dateCreated": "2021-02-26 12:33:03.592",
      "dateStarted": "2021-10-08 16:31:04.370",
      "dateFinished": "2021-10-08 16:31:04.379",
      "status": "FINISHED"
    },
    {
      "text": "%md\n\næœ¬ä¾‹å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨ Flink SQL çš„  `MATCH_RECOGNIZE` æ¥æ£€æµ‹äº‹ä»¶æµä¸­çš„æ¨¡å¼ã€‚\n\nSQL æ—¥å¸¸å¼€å‘ä¸­çš„ä¸€ä¸ªå¸¸è§çš„ä»»åŠ¡ï¼ˆä½†æ˜¯éå¸¸å¤æ‚ï¼‰æ˜¯è¯†åˆ«æ•°æ®é›†ä¸­æœ‰æ„ä¹‰çš„äº‹ä»¶åºåˆ— - é€šå¸¸ç§°ä¸º  Complex Event Processing (CEP) å¤æ‚äº‹ä»¶å¤„ç†ã€‚å•å¤„ç†æµå¼æ•°æ®æ—¶è¿™ä¸ªä»»åŠ¡æ›´åŠ çš„æ™®éï¼Œå› ä¸ºæˆ‘ä»¬æƒ³å¯¹å·²çŸ¥çš„æ¨¡å¼æˆ–è€…å˜åŒ–è¶‹åŠ¿å¿«é€Ÿåšå‡ºååº”ä»¥æä¾›æœ€æ–°çš„ä¸šåŠ¡æ´å¯Ÿã€‚ åœ¨ FLINK SQL ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨æ ‡å‡† SQL è¯­å¥ [`MATCH_RECOGNIZE`](https://ci.apache.org/projects/flink/flink-docs-stable/dev/table/streaming/match_recognize.html)æ¥è½»æ˜“çš„å®ç°è¿™ä¸ªä»»åŠ¡ã€‚\n\n## åˆ†è§£ MATCH_RECOGNIZE\n\næœ¬ä¾‹ä¸­æˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°é‚£äº›å°†è®¢é˜…æœåŠ¡ä»æŸä¸ªé«˜çš„ç­‰çº§(`type IN (\u0027premium\u0027,\u0027platinum\u0027)`) é™åˆ°åŸºç¡€ç­‰çº§çš„ç”¨æˆ·ã€‚\n\n#### è¾“å…¥\n\n`MATCH_RECOGNIZE` çš„è¾“å…¥å‚æ•°å°†æ˜¯ä¸€ä¸ªåŸºäº`subscriptions` çš„æ¨¡å¼è¡¨ã€‚é¦–å…ˆå¿…é¡»å¯¹è¾“å…¥æ¨¡å¼è¡¨è¿›è¡Œé€»è¾‘åˆ†åŒºå’Œæ’åºæ¥ä¿è¯äº‹ä»¶å¤„ç†çš„æ­£ç¡®æ€§å’Œç¡®å®šæ€§\n\n```sql\nPARTITION BY user_id \nORDER BY proc_time\n```\n\n#### è¾“å‡º\n\nè®°å½•çš„æ¨¡å¼å­—æ®µå®šä¹‰åœ¨  `MEASURES` è¯­å¥ä¸­ï¼Œå¯ä»¥ç†è§£ä¸º `MATCH_RECOGNIZE` çš„ `SELECT`ã€‚ å¦‚æœä½ å¯¹é™çº§äº‹ä»¶ä¹‹å‰çš„æœ€åä¸€æ¬¡äº‹ä»¶å…³è”çš„é«˜çº§è®¢é˜…ç±»å‹æ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥ä½¿ç”¨ [logical offset](https://ci.apache.org/projects/flink/flink-docs-stable/dev/table/streaming/match_recognize.html#logical-offsets) æ“ä½œå­ `LAST` æ¥è·å–å®ƒã€‚é™çº§çš„æ—¥æœŸå¯ä»¥ä»ä»»ä½•é«˜çº§è®¢é˜…æœåŠ¡åç´§è·Ÿçš„åŸºç¡€è®¢é˜…æœåŠ¡çš„ `start_date` æ¥æ¨æµ‹å‡ºæ¥ã€‚\n\n```sql\nMEASURES\n  LAST(PREMIUM.type) AS premium_type,\n  AVG(TIMESTAMPDIFF(DAY,PREMIUM.start_date,PREMIUM.end_date)) AS premium_avg_duration,\n  BASIC.start_date AS downgrade_date\nAFTER MATCH SKIP PAST LAST ROW\n```\n\n#### å®šä¹‰æ¨¡å¼\n\nPatterns ä½¿ç”¨ row-pattern å˜é‡ï¼ˆå³ event typesï¼‰å’Œæ­£åˆ™è¡¨è¾¾å¼å®šä¹‰åœ¨ `PATTERN` ä¸­ã€‚è¿™äº›å˜é‡å¿…é¡»ä½¿ç”¨ `DEFINE` æ¥ä¸äº‹ä»¶å¿…é¡»è¾¾æˆçš„æ¨¡å¼æ¡ä»¶è¿›è¡Œå…³è”ï¼Œè¿™é‡Œæˆ‘ä»¬å…³å¿ƒåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªé«˜çº§è®¢é˜…æœåŠ¡äº‹ä»¶ (`PREMIUM+`)ç´§è·Ÿä¸€ä¸ªåŸºç¡€è®¢é˜…æœåŠ¡äº‹ä»¶(`BASIC`):\n\n```sql\nPATTERN (PREMIUM+ BASIC)\nDEFINE PREMIUM AS PREMIUM.type IN (\u0027premium\u0027,\u0027platinum\u0027),\nBASIC AS BASIC.type \u003d \u0027basic\u0027);\n```\n",
      "user": "anonymous",
      "dateUpdated": "2021-03-18 15:55:24.859",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true,
          "completionKey": "TAB",
          "completionSupport": false
        },
        "colWidth": 12.0,
        "editorMode": "ace/mode/markdown",
        "fontSize": 9.0,
        "results": {},
        "enabled": true,
        "editorHide": true,
        "tableHide": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "\u003cdiv class\u003d\"markdown-body\"\u003e\n\u003cp\u003eæœ¬ä¾‹å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨ Flink SQL çš„  \u003ccode\u003eMATCH_RECOGNIZE\u003c/code\u003e æ¥æ£€æµ‹äº‹ä»¶æµä¸­çš„æ¨¡å¼ã€‚\u003c/p\u003e\n\u003cp\u003eSQL æ—¥å¸¸å¼€å‘ä¸­çš„ä¸€ä¸ªå¸¸è§çš„ä»»åŠ¡ï¼ˆä½†æ˜¯éå¸¸å¤æ‚ï¼‰æ˜¯è¯†åˆ«æ•°æ®é›†ä¸­æœ‰æ„ä¹‰çš„äº‹ä»¶åºåˆ— - é€šå¸¸ç§°ä¸º  Complex Event Processing (CEP) å¤æ‚äº‹ä»¶å¤„ç†ã€‚å•å¤„ç†æµå¼æ•°æ®æ—¶è¿™ä¸ªä»»åŠ¡æ›´åŠ çš„æ™®éï¼Œå› ä¸ºæˆ‘ä»¬æƒ³å¯¹å·²çŸ¥çš„æ¨¡å¼æˆ–è€…å˜åŒ–è¶‹åŠ¿å¿«é€Ÿåšå‡ºååº”ä»¥æä¾›æœ€æ–°çš„ä¸šåŠ¡æ´å¯Ÿã€‚ åœ¨ FLINK SQL ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨æ ‡å‡† SQL è¯­å¥ \u003ca href\u003d\"https://ci.apache.org/projects/flink/flink-docs-stable/dev/table/streaming/match_recognize.html\"\u003e\u003ccode\u003eMATCH_RECOGNIZE\u003c/code\u003e\u003c/a\u003eæ¥è½»æ˜“çš„å®ç°è¿™ä¸ªä»»åŠ¡ã€‚\u003c/p\u003e\n\u003ch2\u003eåˆ†è§£ MATCH_RECOGNIZE\u003c/h2\u003e\n\u003cp\u003eæœ¬ä¾‹ä¸­æˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°é‚£äº›å°†è®¢é˜…æœåŠ¡ä»æŸä¸ªé«˜çš„ç­‰çº§(\u003ccode\u003etype IN (\u0027premium\u0027,\u0027platinum\u0027)\u003c/code\u003e) é™åˆ°åŸºç¡€ç­‰çº§çš„ç”¨æˆ·ã€‚\u003c/p\u003e\n\u003ch4\u003eè¾“å…¥\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003eMATCH_RECOGNIZE\u003c/code\u003e çš„è¾“å…¥å‚æ•°å°†æ˜¯ä¸€ä¸ªåŸºäº\u003ccode\u003esubscriptions\u003c/code\u003e çš„æ¨¡å¼è¡¨ã€‚é¦–å…ˆå¿…é¡»å¯¹è¾“å…¥æ¨¡å¼è¡¨è¿›è¡Œé€»è¾‘åˆ†åŒºå’Œæ’åºæ¥ä¿è¯äº‹ä»¶å¤„ç†çš„æ­£ç¡®æ€§å’Œç¡®å®šæ€§\u003c/p\u003e\n\u003cpre\u003e\u003ccode class\u003d\"language-sql\"\u003ePARTITION BY user_id \nORDER BY proc_time\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4\u003eè¾“å‡º\u003c/h4\u003e\n\u003cp\u003eè®°å½•çš„æ¨¡å¼å­—æ®µå®šä¹‰åœ¨  \u003ccode\u003eMEASURES\u003c/code\u003e è¯­å¥ä¸­ï¼Œå¯ä»¥ç†è§£ä¸º \u003ccode\u003eMATCH_RECOGNIZE\u003c/code\u003e çš„ \u003ccode\u003eSELECT\u003c/code\u003eã€‚ å¦‚æœä½ å¯¹é™çº§äº‹ä»¶ä¹‹å‰çš„æœ€åä¸€æ¬¡äº‹ä»¶å…³è”çš„é«˜çº§è®¢é˜…ç±»å‹æ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥ä½¿ç”¨ \u003ca href\u003d\"https://ci.apache.org/projects/flink/flink-docs-stable/dev/table/streaming/match_recognize.html#logical-offsets\"\u003elogical offset\u003c/a\u003e æ“ä½œå­ \u003ccode\u003eLAST\u003c/code\u003e æ¥è·å–å®ƒã€‚é™çº§çš„æ—¥æœŸå¯ä»¥ä»ä»»ä½•é«˜çº§è®¢é˜…æœåŠ¡åç´§è·Ÿçš„åŸºç¡€è®¢é˜…æœåŠ¡çš„ \u003ccode\u003estart_date\u003c/code\u003e æ¥æ¨æµ‹å‡ºæ¥ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode class\u003d\"language-sql\"\u003eMEASURES\n  LAST(PREMIUM.type) AS premium_type,\n  AVG(TIMESTAMPDIFF(DAY,PREMIUM.start_date,PREMIUM.end_date)) AS premium_avg_duration,\n  BASIC.start_date AS downgrade_date\nAFTER MATCH SKIP PAST LAST ROW\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4\u003eå®šä¹‰æ¨¡å¼\u003c/h4\u003e\n\u003cp\u003ePatterns ä½¿ç”¨ row-pattern å˜é‡ï¼ˆå³ event typesï¼‰å’Œæ­£åˆ™è¡¨è¾¾å¼å®šä¹‰åœ¨ \u003ccode\u003ePATTERN\u003c/code\u003e ä¸­ã€‚è¿™äº›å˜é‡å¿…é¡»ä½¿ç”¨ \u003ccode\u003eDEFINE\u003c/code\u003e æ¥ä¸äº‹ä»¶å¿…é¡»è¾¾æˆçš„æ¨¡å¼æ¡ä»¶è¿›è¡Œå…³è”ï¼Œè¿™é‡Œæˆ‘ä»¬å…³å¿ƒåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªé«˜çº§è®¢é˜…æœåŠ¡äº‹ä»¶ (\u003ccode\u003ePREMIUM+\u003c/code\u003e)ç´§è·Ÿä¸€ä¸ªåŸºç¡€è®¢é˜…æœåŠ¡äº‹ä»¶(\u003ccode\u003eBASIC\u003c/code\u003e):\u003c/p\u003e\n\u003cpre\u003e\u003ccode class\u003d\"language-sql\"\u003ePATTERN (PREMIUM+ BASIC)\nDEFINE PREMIUM AS PREMIUM.type IN (\u0027premium\u0027,\u0027platinum\u0027),\nBASIC AS BASIC.type \u003d \u0027basic\u0027);\n\u003c/code\u003e\u003c/pre\u003e\n\n\u003c/div\u003e"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1615182073519_1664177331",
      "id": "paragraph_1615182073519_1664177331",
      "dateCreated": "2021-03-08 05:41:13.519",
      "dateStarted": "2021-03-18 15:55:24.860",
      "dateFinished": "2021-03-18 15:55:24.883",
      "status": "FINISHED"
    },
    {
      "text": "%flink.ssql\n\nDROP TABLE IF EXISTS subscriptions;\n\nCREATE TABLE subscriptions ( \n    id STRING,\n    user_id INT,\n    type STRING,\n    start_date TIMESTAMP(3),\n    end_date TIMESTAMP(3),\n    payment_expiration TIMESTAMP(3),\n    proc_time AS PROCTIME()\n) WITH (\n  \u0027connector\u0027 \u003d \u0027faker\u0027,\n  \u0027fields.id.expression\u0027 \u003d \u0027#{Internet.uuid}\u0027, \n  \u0027fields.user_id.expression\u0027 \u003d \u0027#{number.numberBetween \u0027\u00271\u0027\u0027,\u0027\u002750\u0027\u0027}\u0027,\n  \u0027fields.type.expression\u0027\u003d \u0027#{regexify \u0027\u0027(basic|premium|platinum){1}\u0027\u0027}\u0027,\n  \u0027fields.start_date.expression\u0027 \u003d \u0027#{date.past \u0027\u002730\u0027\u0027,\u0027\u0027DAYS\u0027\u0027}\u0027,\n  \u0027fields.end_date.expression\u0027 \u003d \u0027#{date.future \u0027\u002715\u0027\u0027,\u0027\u0027DAYS\u0027\u0027}\u0027,\n  \u0027fields.payment_expiration.expression\u0027 \u003d \u0027#{date.future \u0027\u0027365\u0027\u0027,\u0027\u0027DAYS\u0027\u0027}\u0027\n);\n",
      "user": "anonymous",
      "dateUpdated": "2021-03-08 06:24:42.763",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "sql",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "colWidth": 12.0,
        "editorMode": "ace/mode/sql",
        "fontSize": 9.0,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1614304752771_1974165087",
      "id": "paragraph_1614304752771_1974165087",
      "dateCreated": "2021-02-26 09:59:12.771",
      "dateStarted": "2021-03-08 06:24:43.001",
      "dateFinished": "2021-03-08 06:25:39.015",
      "status": "FINISHED"
    },
    {
      "text": "%flink.ssql(type\u003dupdate)\n\nSELECT * \nFROM subscriptions\n     MATCH_RECOGNIZE (PARTITION BY user_id \n                      ORDER BY proc_time\n                      MEASURES\n                        LAST(PREMIUM.type) AS premium_type,\n                        AVG(TIMESTAMPDIFF(DAY,PREMIUM.start_date,PREMIUM.end_date)) AS premium_avg_duration,\n                        BASIC.start_date AS downgrade_date\n                      AFTER MATCH SKIP PAST LAST ROW\n                      --Pattern: one or more \u0027premium\u0027 or \u0027platinum\u0027 subscription events (PREMIUM)\n                      --followed by a \u0027basic\u0027 subscription event (BASIC) for the same `user_id`\n                      PATTERN (PREMIUM+ BASIC)\n                      DEFINE PREMIUM AS PREMIUM.type IN (\u0027premium\u0027,\u0027platinum\u0027),\n                             BASIC AS BASIC.type \u003d \u0027basic\u0027)\nORDER BY downgrade_date DESC\nLIMIT 10;\n    \n    ",
      "user": "anonymous",
      "dateUpdated": "2021-03-08 06:25:41.489",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "sql",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "colWidth": 12.0,
        "editorMode": "ace/mode/sql",
        "fontSize": 9.0,
        "results": {
          "0": {
            "graph": {
              "mode": "table",
              "height": 300.0,
              "optionOpen": false,
              "setting": {
                "table": {
                  "tableGridState": {},
                  "tableColumnTypeState": {
                    "names": {
                      "user_id": "string",
                      "premium_type": "string",
                      "premium_avg_duration": "string",
                      "downgrade_date": "string"
                    },
                    "updated": false
                  },
                  "tableOptionSpecHash": "[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]",
                  "tableOptionValue": {
                    "useFilter": false,
                    "showPagination": false,
                    "showAggregationFooter": false
                  },
                  "updated": false,
                  "initialized": false
                }
              },
              "commonSetting": {}
            }
          }
        },
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "runtimeInfos": {
        "jobUrl": {
          "propertyName": "jobUrl",
          "label": "FLINK JOB",
          "tooltip": "View in Flink web UI",
          "group": "flink",
          "values": [
            {
              "jobUrl": "http://localhost:8081#/job/f8dd6b5f8893de3f674fa09c208740f6"
            }
          ],
          "interpreterSettingId": "flink"
        }
      },
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1614304878963_1234532072",
      "id": "paragraph_1614304878963_1234532072",
      "dateCreated": "2021-02-26 10:01:18.963",
      "dateStarted": "2021-03-08 06:25:41.639",
      "dateFinished": "2021-03-08 06:26:52.127",
      "status": "ABORT"
    },
    {
      "text": "%flink.ssql\n",
      "user": "anonymous",
      "dateUpdated": "2021-02-26 10:01:36.350",
      "progress": 0,
      "config": {},
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1614304896350_1586012396",
      "id": "paragraph_1614304896350_1586012396",
      "dateCreated": "2021-02-26 10:01:36.350",
      "status": "READY"
    }
  ],
  "name": "08 Detecting patterns with MATCH_RECOGNIZE",
  "id": "2FYC4KQ45",
  "defaultInterpreterGroup": "flink",
  "version": "0.10.0-SNAPSHOT",
  "noteParams": {},
  "noteForms": {},
  "angularObjects": {},
  "config": {
    "isZeppelinNotebookCronEnable": false
  },
  "info": {}
}